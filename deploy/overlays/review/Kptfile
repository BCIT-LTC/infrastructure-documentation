apiVersion: kpt.dev/v1
kind: Kptfile
metadata:
  name: package
  annotations:
    config.kubernetes.io/local-config: "true"
info:
  description: review overlay deployment package
pipeline:
  mutators:
    - image: gcr.io/kpt-fn/search-replace:v0.2.0
      configMap:
        by-path: spec.**.host
        put-value: review_{branchName}_{projectName}.ltc.bcit.ca/ # kpt-set: ${INGRESS_HOST}
    - image: gcr.io/kpt-fn/search-replace:v0.2.0
      configMap:
        by-path: spec.**.hosts[*]
        put-value: review_{branchName}_{projectName}.ltc.bcit.ca/ # kpt-set: ${INGRESS_HOST}
  validators:
    - image: gcr.io/kpt-fn/kubeval:v0.2.0
      configMap:
        skip_kinds: Kustomization,ResourceGroup,Kptfile
        strict: "true"
